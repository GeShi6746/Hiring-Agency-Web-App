<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "com.example.hiringagency.DAO.StaffMapper">

    <insert id="setAd" parameterType="com.example.hiringagency.domain.entity.JobAdvertisements">
        insert into JobAdvertisements(`serviceType`, `educationRequirement`, `experience`)
        values (#{serviceType}, #{educationRequirement}, #{experience})
    </insert>

    <select id="selectAllAds" resultType="com.example.hiringagency.domain.entity.JobAdvertisements">
        select *
        from JobAdvertisements
    </select>

    <delete id="deleteAd" parameterType="com.example.hiringagency.domain.entity.JobAdvertisements">
        delete from JobAdvertisements
        where jobAdvertisementId = #{jobAdvertisementId}
    </delete>

    <!-- 接下来4个都是为了hire HP-->
    <insert id="addHPAccount" parameterType="com.example.hiringagency.domain.entity.Users">
        insert into Users(`firstName`, `lastName`,`username`, `password`, `firstLogin`, `postalAddress`, `phoneNumber`,`email`,`type`, `isBlocked`, `hourlyRate`)
        values (#{firstName}, #{lastName}, #{username}, #{password}, 0, #{postalAddress}, #{phoneNumber}, #{email}, 3, 0, #{hourlyRate})
    </insert>

    <select id="selectHPInfoById" resultType="com.example.hiringagency.domain.model.Info">
        select firstName, lastName, postalAddress, phoneNumber, email
        from HealthcareJobApplication
        where healthcareJobApplicationId = #{healthcareJobApplicationId}
    </select>

    <select id="selectMaxId" resultType="java.lang.Long">
        select MAX(userId)
        from Users
    </select>

    <update id="updateHPId">
        update HealthcareJobApplication
        set userId = #{userId}
        where healthcareJobApplicationId = #{healthcareJobApplicationId}
    </update>

    <!-- list hired HP -->
    <select id="selectAllHP" resultType="com.example.hiringagency.domain.entity.Users">
        select *
        from Users
        where Type = 3 and isDeleted = 0
    </select>

    <!-- 接下来3个都是为了approve CT-->
    <insert id="addCTAccount" parameterType="com.example.hiringagency.domain.entity.Users">
        insert into Users(`firstName`, `lastName`,`username`, `password`, `firstLogin`, `postalAddress`, `phoneNumber`,`email`,`type`, `isBlocked`)
        values (#{firstName}, #{lastName}, #{username}, #{password}, 0, #{postalAddress}, #{phoneNumber}, #{email}, 2, 0)
    </insert>

    <select id="selectCTInfoById" resultType="com.example.hiringagency.domain.model.Info">
        select firstName, lastName, postalAddress, phoneNumber, email
        from CareTakerRegistration
        where careTakerRegistrationId = #{careTakerRegistrationId}
    </select>

    <update id="updateCTId">
        update CareTakerRegistration
        set userId = #{userId}
        where careTakerRegistrationId = #{careTakerRegistrationId}
    </update>

    <!-- approved CT -->
    <select id="selectAllCT" resultType="com.example.hiringagency.domain.entity.Users">
        select *
        from Users
        where Type = 2 and isDeleted = 0
    </select>

    <select id="selectHPbyRequest" resultType="com.example.hiringagency.domain.entity.HealthcareJobApplication">
        select *
        from HealthcareJobApplication
        where active = 0 and serviceType = #{serviceType} and gender = #{genderSpecific}
    </select>

    <select id="selectAllRequests" resultType="com.example.hiringagency.domain.entity.CareRequests">
        select *
        from CareRequests
    </select>

    <select id="selectServiceEntries" resultType="com.example.hiringagency.domain.entity.ServiceEntries">
        select *
        from ServiceEntries
        where careRequestId = #{careRequestId}
    </select>

    <select id="selectRequestById" resultType="com.example.hiringagency.domain.entity.CareRequests">
        select *
        from CareRequests
        where careRequestId = #{careRequestId}
    </select>

    <select id="selectEntriesById" resultType="com.example.hiringagency.domain.entity.ServiceEntries">
        select *
        from ServiceEntries
        where serviceEntryId = #{serviceEntryId}
    </select>

    <select id="selectEntriesByHp" resultType="com.example.hiringagency.domain.entity.ServiceEntries">
        select *
        from ServiceEntries
        where hpId = #{userId}
    </select>

    <update id="assignHP" parameterType="com.example.hiringagency.domain.entity.ServiceEntries">
        update ServiceEntries
        set hpId = #{userId}
        where serviceEntryId = #{serviceEntryId}
    </update>

    <update id="deAssignHP" parameterType="com.example.hiringagency.domain.entity.ServiceEntries">
        update ServiceEntries
        set hpId = null
        where serviceEntryId = #{serviceEntryId}
    </update>

    <insert id="addBilling" parameterType="com.example.hiringagency.domain.entity.Billing">
        insert into Billing(`careTakerId`, `careRequestId`, `hourlyRate`, `paidAmount`, `amountYetToPay`)
        values (#{careTakerId}, #{careRequestId}, #{hourlyRate}, 0, 0)
    </insert>

    <select id="selectBilling" resultType="com.example.hiringagency.domain.entity.Billing">
        select *
        from Billing
    </select>

    <update id="pay" parameterType="com.example.hiringagency.domain.entity.Billing">
        update Billing
        set paidAmount = paidAmount + #{amount}
        where billingId = #{billingId}
    </update>

    <update id="softDeleteCT" parameterType="com.example.hiringagency.domain.entity.Users">
        update Users
        set isDeleted = 1
        where userId = #{careTakerId}
    </update>

    <delete id="withdraw" parameterType="com.example.hiringagency.domain.entity.ServiceEntries">
        delete from ServiceEntries
        where serviceEntryId = #{serviceEntryId}
    </delete>

    <select id="selectRequestByCt" resultType="com.example.hiringagency.domain.entity.CareRequests">
        select *
        from CareRequests
        where careTakerId = #{careTakerId}
    </select>
</mapper>
